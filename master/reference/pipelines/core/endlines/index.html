
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/logo/edsnlp.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.11">
    
    
      
        <title>`edsnlp.pipelines.core.endlines` - EDS-NLP</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../assets/termynal/termynal.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#edsnlppipelinescoreendlines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="EDS-NLP" class="md-header__button md-logo" aria-label="EDS-NLP" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EDS-NLP
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              `edsnlp.pipelines.core.endlines`
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aphp/edsnlp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aphp/edsnlp
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="EDS-NLP" class="md-nav__button md-logo" aria-label="EDS-NLP" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    EDS-NLP
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aphp/edsnlp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aphp/edsnlp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Getting started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://aphp.github.io/edsnlp/demo" target="_blank" class="md-nav__link">
        Demo
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../tutorials/">Tutorials</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/spacy101/" class="md-nav__link">
        spaCy 101
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/matching-a-terminology/" class="md-nav__link">
        Matching a terminology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/qualifying-entities/" class="md-nav__link">
        Qualifying entities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/detecting-dates/" class="md-nav__link">
        Detecting dates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/multiple-texts/" class="md-nav__link">
        Processing multiple texts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/endlines/" class="md-nav__link">
        Detecting end-of-lines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/reason/" class="md-nav__link">
        Detecting Reason of Hospitalisation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../advanced-tutorials/">Advanced tutorials</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Advanced tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Advanced tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced-tutorials/word-vectors/" class="md-nav__link">
        Word embeddings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced-tutorials/fastapi/" class="md-nav__link">
        Deploying as an API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://spacy.io/usage/processing-pipelines#custom-components" target="_blank" class="md-nav__link">
        Creating a pipeline
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../pipelines/">Pipelines</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Pipelines" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Pipelines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/architecture/" class="md-nav__link">
        Basic Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../pipelines/core/">Core Pipelines</a>
          
            <label for="__nav_5_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Core Pipelines" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Core Pipelines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/core/matcher/" class="md-nav__link">
        Matcher
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/core/normalisation/" class="md-nav__link">
        Normalisation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/core/endlines/" class="md-nav__link">
        Endlines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/core/sentences/" class="md-nav__link">
        Sentences
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../pipelines/qualifiers/">Qualifiers</a>
          
            <label for="__nav_5_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Qualifiers" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Qualifiers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/qualifiers/negation/" class="md-nav__link">
        Negation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/qualifiers/family/" class="md-nav__link">
        Family
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/qualifiers/hypothesis/" class="md-nav__link">
        Hypothesis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/qualifiers/reported-speech/" class="md-nav__link">
        Reported Speech
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/qualifiers/history/" class="md-nav__link">
        Medical History
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_5" type="checkbox" id="__nav_5_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../pipelines/misc/">Miscellaneous</a>
          
            <label for="__nav_5_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Miscellaneous" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/misc/dates/" class="md-nav__link">
        Dates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/misc/measures/" class="md-nav__link">
        Measures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/misc/consultation-dates/" class="md-nav__link">
        Consultation Dates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/misc/sections/" class="md-nav__link">
        Sections
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/misc/reason/" class="md-nav__link">
        Reason
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_6" type="checkbox" id="__nav_5_6" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../pipelines/ner/">Named Entity Recognition</a>
          
            <label for="__nav_5_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Named Entity Recognition" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_6">
          <span class="md-nav__icon md-icon"></span>
          Named Entity Recognition
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/ner/score/" class="md-nav__link">
        Score
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../pipelines/ner/covid/" class="md-nav__link">
        COVID
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../languages/" class="md-nav__link">
        Languages
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../utilities/connectors/">Connectors</a>
          
            <label for="__nav_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Connectors" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Connectors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../utilities/connectors/brat/" class="md-nav__link">
        BRAT Connector
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../utilities/connectors/omop/" class="md-nav__link">
        OMOP Connector
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../utilities/tests/">Utilities</a>
          
            <label for="__nav_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Utilities" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../utilities/tests/blocs/" class="md-nav__link">
        Testing Code Blocs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../utilities/tests/examples/" class="md-nav__link">
        Creating Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../utilities/matchers/" class="md-nav__link">
        Matchers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_9">
          Code Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1" type="checkbox" id="__nav_9_1" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../">edsnlp</a>
          
            <label for="__nav_9_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="edsnlp" data-md-level="2">
        <label class="md-nav__title" for="__nav_9_1">
          <span class="md-nav__icon md-icon"></span>
          edsnlp
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../components/" class="md-nav__link">
        components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../conjugator/" class="md-nav__link">
        conjugator
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_4" type="checkbox" id="__nav_9_1_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../connectors/">connectors</a>
          
            <label for="__nav_9_1_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="connectors" data-md-level="3">
        <label class="md-nav__title" for="__nav_9_1_4">
          <span class="md-nav__icon md-icon"></span>
          connectors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../connectors/brat/" class="md-nav__link">
        brat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../connectors/labeltool/" class="md-nav__link">
        labeltool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../connectors/omop/" class="md-nav__link">
        omop
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../extensions/" class="md-nav__link">
        extensions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../language/" class="md-nav__link">
        language
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_7" type="checkbox" id="__nav_9_1_7" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../matchers/">matchers</a>
          
            <label for="__nav_9_1_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="matchers" data-md-level="3">
        <label class="md-nav__title" for="__nav_9_1_7">
          <span class="md-nav__icon md-icon"></span>
          matchers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../matchers/regex/" class="md-nav__link">
        regex
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_7_3" type="checkbox" id="__nav_9_1_7_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../matchers/utils/">utils</a>
          
            <label for="__nav_9_1_7_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="utils" data-md-level="4">
        <label class="md-nav__title" for="__nav_9_1_7_3">
          <span class="md-nav__icon md-icon"></span>
          utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../matchers/utils/offset/" class="md-nav__link">
        offset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../matchers/utils/text/" class="md-nav__link">
        text
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8" type="checkbox" id="__nav_9_1_8" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">pipelines</a>
          
            <label for="__nav_9_1_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="pipelines" data-md-level="3">
        <label class="md-nav__title" for="__nav_9_1_8">
          <span class="md-nav__icon md-icon"></span>
          pipelines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../base/" class="md-nav__link">
        base
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3" type="checkbox" id="__nav_9_1_8_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">core</a>
          
            <label for="__nav_9_1_8_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="core" data-md-level="4">
        <label class="md-nav__title" for="__nav_9_1_8_3">
          <span class="md-nav__icon md-icon"></span>
          core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_2" type="checkbox" id="__nav_9_1_8_3_2" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../advanced/">advanced</a>
          
            <label for="__nav_9_1_8_3_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="advanced" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_3_2">
          <span class="md-nav__icon md-icon"></span>
          advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/advanced/" class="md-nav__link">
        advanced
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_3" type="checkbox" id="__nav_9_1_8_3_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../context/">context</a>
          
            <label for="__nav_9_1_8_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="context" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_3_3">
          <span class="md-nav__icon md-icon"></span>
          context
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../context/context/" class="md-nav__link">
        context
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../context/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_4" type="checkbox" id="__nav_9_1_8_3_4" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index md-nav__link--active">
          <a href="./">endlines</a>
          
            <label for="__nav_9_1_8_3_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="endlines" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_3_4">
          <span class="md-nav__icon md-icon"></span>
          endlines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="endlines/" class="md-nav__link">
        endlines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="endlinesmodel/" class="md-nav__link">
        endlinesmodel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="functional/" class="md-nav__link">
        functional
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_5" type="checkbox" id="__nav_9_1_8_3_5" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../matcher/">matcher</a>
          
            <label for="__nav_9_1_8_3_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="matcher" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_3_5">
          <span class="md-nav__icon md-icon"></span>
          matcher
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../matcher/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../matcher/matcher/" class="md-nav__link">
        matcher
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_6" type="checkbox" id="__nav_9_1_8_3_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../normalizer/">normalizer</a>
          
            <label for="__nav_9_1_8_3_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="normalizer" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_3_6">
          <span class="md-nav__icon md-icon"></span>
          normalizer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_6_2" type="checkbox" id="__nav_9_1_8_3_6_2" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../normalizer/accents/">accents</a>
          
            <label for="__nav_9_1_8_3_6_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="accents" data-md-level="6">
        <label class="md-nav__title" for="__nav_9_1_8_3_6_2">
          <span class="md-nav__icon md-icon"></span>
          accents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/accents/accents/" class="md-nav__link">
        accents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/accents/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/accents/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_6_4" type="checkbox" id="__nav_9_1_8_3_6_4" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../normalizer/lowercase/">lowercase</a>
          
            <label for="__nav_9_1_8_3_6_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="lowercase" data-md-level="6">
        <label class="md-nav__title" for="__nav_9_1_8_3_6_4">
          <span class="md-nav__icon md-icon"></span>
          lowercase
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/lowercase/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/normalizer/" class="md-nav__link">
        normalizer
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_6_6" type="checkbox" id="__nav_9_1_8_3_6_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../normalizer/pollution/">pollution</a>
          
            <label for="__nav_9_1_8_3_6_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="pollution" data-md-level="6">
        <label class="md-nav__title" for="__nav_9_1_8_3_6_6">
          <span class="md-nav__icon md-icon"></span>
          pollution
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/pollution/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/pollution/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/pollution/pollution/" class="md-nav__link">
        pollution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_6_7" type="checkbox" id="__nav_9_1_8_3_6_7" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../normalizer/quotes/">quotes</a>
          
            <label for="__nav_9_1_8_3_6_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="quotes" data-md-level="6">
        <label class="md-nav__title" for="__nav_9_1_8_3_6_7">
          <span class="md-nav__icon md-icon"></span>
          quotes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/quotes/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/quotes/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../normalizer/quotes/quotes/" class="md-nav__link">
        quotes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_3_7" type="checkbox" id="__nav_9_1_8_3_7" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../sentences/">sentences</a>
          
            <label for="__nav_9_1_8_3_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="sentences" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_3_7">
          <span class="md-nav__icon md-icon"></span>
          sentences
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sentences/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sentences/sentences/" class="md-nav__link">
        sentences
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sentences/terms/" class="md-nav__link">
        terms
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../factories/" class="md-nav__link">
        factories
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_5" type="checkbox" id="__nav_9_1_8_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../misc/">misc</a>
          
            <label for="__nav_9_1_8_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="misc" data-md-level="4">
        <label class="md-nav__title" for="__nav_9_1_8_5">
          <span class="md-nav__icon md-icon"></span>
          misc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_5_2" type="checkbox" id="__nav_9_1_8_5_2" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../misc/consultation_dates/">consultation_dates</a>
          
            <label for="__nav_9_1_8_5_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="consultation_dates" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_5_2">
          <span class="md-nav__icon md-icon"></span>
          consultation_dates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/consultation_dates/consultation_dates/" class="md-nav__link">
        consultation_dates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/consultation_dates/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/consultation_dates/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_5_3" type="checkbox" id="__nav_9_1_8_5_3" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../misc/dates/">dates</a>
          
            <label for="__nav_9_1_8_5_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="dates" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_5_3">
          <span class="md-nav__icon md-icon"></span>
          dates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/dates/" class="md-nav__link">
        dates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/models/" class="md-nav__link">
        models
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_5_3_5" type="checkbox" id="__nav_9_1_8_5_3_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../misc/dates/patterns/">patterns</a>
          
            <label for="__nav_9_1_8_5_3_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="patterns" data-md-level="6">
        <label class="md-nav__title" for="__nav_9_1_8_5_3_5">
          <span class="md-nav__icon md-icon"></span>
          patterns
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/absolute/" class="md-nav__link">
        absolute
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_5_3_5_3" type="checkbox" id="__nav_9_1_8_5_3_5_3" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../misc/dates/patterns/atomic/">atomic</a>
          
            <label for="__nav_9_1_8_5_3_5_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="atomic" data-md-level="7">
        <label class="md-nav__title" for="__nav_9_1_8_5_3_5_3">
          <span class="md-nav__icon md-icon"></span>
          atomic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/days/" class="md-nav__link">
        days
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/delimiters/" class="md-nav__link">
        delimiters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/directions/" class="md-nav__link">
        directions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/modes/" class="md-nav__link">
        modes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/months/" class="md-nav__link">
        months
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/numbers/" class="md-nav__link">
        numbers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/time/" class="md-nav__link">
        time
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/units/" class="md-nav__link">
        units
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/atomic/years/" class="md-nav__link">
        years
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/current/" class="md-nav__link">
        current
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/duration/" class="md-nav__link">
        duration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/false_positive/" class="md-nav__link">
        false_positive
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/dates/patterns/relative/" class="md-nav__link">
        relative
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_5_4" type="checkbox" id="__nav_9_1_8_5_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../misc/measures/">measures</a>
          
            <label for="__nav_9_1_8_5_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="measures" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_5_4">
          <span class="md-nav__icon md-icon"></span>
          measures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/measures/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/measures/measures/" class="md-nav__link">
        measures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/measures/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_5_5" type="checkbox" id="__nav_9_1_8_5_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../misc/reason/">reason</a>
          
            <label for="__nav_9_1_8_5_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="reason" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_5_5">
          <span class="md-nav__icon md-icon"></span>
          reason
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/reason/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/reason/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/reason/reason/" class="md-nav__link">
        reason
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_5_6" type="checkbox" id="__nav_9_1_8_5_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../misc/sections/">sections</a>
          
            <label for="__nav_9_1_8_5_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="sections" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_5_6">
          <span class="md-nav__icon md-icon"></span>
          sections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/sections/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/sections/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/sections/sections/" class="md-nav__link">
        sections
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6" type="checkbox" id="__nav_9_1_8_6" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/">ner</a>
          
            <label for="__nav_9_1_8_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="ner" data-md-level="4">
        <label class="md-nav__title" for="__nav_9_1_8_6">
          <span class="md-nav__icon md-icon"></span>
          ner
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6_2" type="checkbox" id="__nav_9_1_8_6_2" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/covid/">covid</a>
          
            <label for="__nav_9_1_8_6_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="covid" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_6_2">
          <span class="md-nav__icon md-icon"></span>
          covid
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/covid/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/covid/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6_3" type="checkbox" id="__nav_9_1_8_6_3" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/scores/">scores</a>
          
            <label for="__nav_9_1_8_6_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="scores" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_6_3">
          <span class="md-nav__icon md-icon"></span>
          scores
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/base_score/" class="md-nav__link">
        base_score
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6_3_3" type="checkbox" id="__nav_9_1_8_6_3_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/scores/charlson/">charlson</a>
          
            <label for="__nav_9_1_8_6_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="charlson" data-md-level="6">
        <label class="md-nav__title" for="__nav_9_1_8_6_3_3">
          <span class="md-nav__icon md-icon"></span>
          charlson
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/charlson/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/charlson/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6_3_4" type="checkbox" id="__nav_9_1_8_6_3_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/scores/emergency/">emergency</a>
          
            <label for="__nav_9_1_8_6_3_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="emergency" data-md-level="6">
        <label class="md-nav__title" for="__nav_9_1_8_6_3_4">
          <span class="md-nav__icon md-icon"></span>
          emergency
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6_3_4_2" type="checkbox" id="__nav_9_1_8_6_3_4_2" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/scores/emergency/ccmu/">ccmu</a>
          
            <label for="__nav_9_1_8_6_3_4_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="ccmu" data-md-level="7">
        <label class="md-nav__title" for="__nav_9_1_8_6_3_4_2">
          <span class="md-nav__icon md-icon"></span>
          ccmu
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/emergency/ccmu/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/emergency/ccmu/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6_3_4_3" type="checkbox" id="__nav_9_1_8_6_3_4_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/scores/emergency/gemsa/">gemsa</a>
          
            <label for="__nav_9_1_8_6_3_4_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="gemsa" data-md-level="7">
        <label class="md-nav__title" for="__nav_9_1_8_6_3_4_3">
          <span class="md-nav__icon md-icon"></span>
          gemsa
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/emergency/gemsa/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/emergency/gemsa/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6_3_4_4" type="checkbox" id="__nav_9_1_8_6_3_4_4" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/scores/emergency/priority/">priority</a>
          
            <label for="__nav_9_1_8_6_3_4_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="priority" data-md-level="7">
        <label class="md-nav__title" for="__nav_9_1_8_6_3_4_4">
          <span class="md-nav__icon md-icon"></span>
          priority
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/emergency/priority/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/emergency/priority/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_6_3_6" type="checkbox" id="__nav_9_1_8_6_3_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ner/scores/sofa/">sofa</a>
          
            <label for="__nav_9_1_8_6_3_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="sofa" data-md-level="6">
        <label class="md-nav__title" for="__nav_9_1_8_6_3_6">
          <span class="md-nav__icon md-icon"></span>
          sofa
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/sofa/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/sofa/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ner/scores/sofa/sofa/" class="md-nav__link">
        sofa
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_7" type="checkbox" id="__nav_9_1_8_7" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../qualifiers/">qualifiers</a>
          
            <label for="__nav_9_1_8_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="qualifiers" data-md-level="4">
        <label class="md-nav__title" for="__nav_9_1_8_7">
          <span class="md-nav__icon md-icon"></span>
          qualifiers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/base/" class="md-nav__link">
        base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/factories/" class="md-nav__link">
        factories
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_7_4" type="checkbox" id="__nav_9_1_8_7_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../qualifiers/family/">family</a>
          
            <label for="__nav_9_1_8_7_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="family" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_7_4">
          <span class="md-nav__icon md-icon"></span>
          family
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/family/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/family/family/" class="md-nav__link">
        family
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/family/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_7_5" type="checkbox" id="__nav_9_1_8_7_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../qualifiers/history/">history</a>
          
            <label for="__nav_9_1_8_7_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="history" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_7_5">
          <span class="md-nav__icon md-icon"></span>
          history
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/history/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/history/history/" class="md-nav__link">
        history
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/history/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_7_6" type="checkbox" id="__nav_9_1_8_7_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../qualifiers/hypothesis/">hypothesis</a>
          
            <label for="__nav_9_1_8_7_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="hypothesis" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_7_6">
          <span class="md-nav__icon md-icon"></span>
          hypothesis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/hypothesis/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/hypothesis/hypothesis/" class="md-nav__link">
        hypothesis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/hypothesis/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_7_7" type="checkbox" id="__nav_9_1_8_7_7" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../qualifiers/negation/">negation</a>
          
            <label for="__nav_9_1_8_7_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="negation" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_7_7">
          <span class="md-nav__icon md-icon"></span>
          negation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/negation/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/negation/negation/" class="md-nav__link">
        negation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/negation/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_8_7_8" type="checkbox" id="__nav_9_1_8_7_8" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../qualifiers/reported_speech/">reported_speech</a>
          
            <label for="__nav_9_1_8_7_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="reported_speech" data-md-level="5">
        <label class="md-nav__title" for="__nav_9_1_8_7_8">
          <span class="md-nav__icon md-icon"></span>
          reported_speech
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/reported_speech/factory/" class="md-nav__link">
        factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/reported_speech/patterns/" class="md-nav__link">
        patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qualifiers/reported_speech/reported_speech/" class="md-nav__link">
        reported_speech
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../terminations/" class="md-nav__link">
        terminations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_9" type="checkbox" id="__nav_9_1_9" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../processing/">processing</a>
          
            <label for="__nav_9_1_9">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="processing" data-md-level="3">
        <label class="md-nav__title" for="__nav_9_1_9">
          <span class="md-nav__icon md-icon"></span>
          processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../processing/distributed/" class="md-nav__link">
        distributed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../processing/helpers/" class="md-nav__link">
        helpers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../processing/parallel/" class="md-nav__link">
        parallel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../processing/simple/" class="md-nav__link">
        simple
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../processing/wrapper/" class="md-nav__link">
        wrapper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_1_10" type="checkbox" id="__nav_9_1_10" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../utils/">utils</a>
          
            <label for="__nav_9_1_10">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="utils" data-md-level="3">
        <label class="md-nav__title" for="__nav_9_1_10">
          <span class="md-nav__icon md-icon"></span>
          utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/blocs/" class="md-nav__link">
        blocs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/colors/" class="md-nav__link">
        colors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/deprecation/" class="md-nav__link">
        deprecation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/examples/" class="md-nav__link">
        examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/filter/" class="md-nav__link">
        filter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/inclusion/" class="md-nav__link">
        inclusion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/regex/" class="md-nav__link">
        regex
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/resources/" class="md-nav__link">
        resources
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/" class="md-nav__link">
        Contributing to EDS-NLP
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.factory" class="md-nav__link">
    factory
  </a>
  
    <nav class="md-nav" aria-label="factory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.factory.create_component" class="md-nav__link">
    create_component()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.functional" class="md-nav__link">
    functional
  </a>
  
    <nav class="md-nav" aria-label="functional">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.functional._get_label" class="md-nav__link">
    _get_label()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.functional.get_dir_path" class="md-nav__link">
    get_dir_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.functional.build_path" class="md-nav__link">
    build_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.functional._convert_series_to_array" class="md-nav__link">
    _convert_series_to_array()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel" class="md-nav__link">
    endlinesmodel
  </a>
  
    <nav class="md-nav" aria-label="endlinesmodel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel" class="md-nav__link">
    EndLinesModel
  </a>
  
    <nav class="md-nav" aria-label="EndLinesModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.nlp" class="md-nav__link">
    nlp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._preprocess_data" class="md-nav__link">
    _preprocess_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.fit_and_predict" class="md-nav__link">
    fit_and_predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.save" class="md-nav__link">
    save()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._convert_A" class="md-nav__link">
    _convert_A()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._convert_B" class="md-nav__link">
    _convert_B()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._convert_raw_data_to_codes" class="md-nav__link">
    _convert_raw_data_to_codes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._convert_line_to_attribute" class="md-nav__link">
    _convert_line_to_attribute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._compute_a3" class="md-nav__link">
    _compute_a3()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_M1" class="md-nav__link">
    _fit_M1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_M2" class="md-nav__link">
    _fit_M2()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._get_X_for_M1" class="md-nav__link">
    _get_X_for_M1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._get_X_for_M2" class="md-nav__link">
    _get_X_for_M2()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._predict_M1" class="md-nav__link">
    _predict_M1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._predict_M2" class="md-nav__link">
    _predict_M2()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_encoder_2S" class="md-nav__link">
    _fit_encoder_2S()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_encoder_1S" class="md-nav__link">
    _fit_encoder_1S()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._encode_series" class="md-nav__link">
    _encode_series()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.set_spans" class="md-nav__link">
    set_spans()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._retrieve_lines" class="md-nav__link">
    _retrieve_lines()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._create_vocabulary" class="md-nav__link">
    _create_vocabulary()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._compute_B" class="md-nav__link">
    _compute_B()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._shift_col" class="md-nav__link">
    _shift_col()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._get_attributes" class="md-nav__link">
    _get_attributes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._get_string" class="md-nav__link">
    _get_string()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_one_hot_encoder" class="md-nav__link">
    _fit_one_hot_encoder()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlines" class="md-nav__link">
    endlines
  </a>
  
    <nav class="md-nav" aria-label="endlines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlines.EndLines" class="md-nav__link">
    EndLines
  </a>
  
    <nav class="md-nav" aria-label="EndLines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlines.EndLines.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlines.EndLines._read_model" class="md-nav__link">
    _read_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlines.EndLines._spacy_compute_a3a4" class="md-nav__link">
    _spacy_compute_a3a4()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlines.EndLines._compute_length" class="md-nav__link">
    _compute_length()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlines.EndLines._get_df" class="md-nav__link">
    _get_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edsnlp.pipelines.core.endlines.endlines.EndLines.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/aphp/edit/master/docs/edsnlp/pipelines/core/endlines/__init__.py" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="edsnlppipelinescoreendlines"><code>edsnlp.pipelines.core.endlines</code></h1>


  <div class="doc doc-object doc-module">


    <div class="doc doc-contents first">




  <div class="doc doc-children">









  <div class="doc doc-object doc-module">



<h3 id="edsnlp.pipelines.core.endlines.factory" class="doc doc-heading">
        <code>factory</code>



</h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="edsnlp.pipelines.core.endlines.factory.create_component" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_component</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span></code>


</h4>


    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/factory.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@deprecated_factory</span><span class="p">(</span><span class="s2">&quot;endlines&quot;</span><span class="p">,</span> <span class="s2">&quot;eds.endlines&quot;</span><span class="p">)</span>
<span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;eds.endlines&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_component</span><span class="p">(</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">):</span>
    <span class="k">return</span> <span class="n">EndLines</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">end_lines_model</span><span class="o">=</span><span class="n">model_path</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="edsnlp.pipelines.core.endlines.functional" class="doc doc-heading">
        <code>functional</code>



</h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="edsnlp.pipelines.core.endlines.functional._get_label" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_get_label</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span></code>


</h4>


    <div class="doc doc-contents ">

      <p>Returns the label for the prediction <code>PREDICTED_END_LINE</code></p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>prediction</code></td>
          <td class="doc-param-details">
            <p>value of <code>PREDICTED_END_LINE</code></p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>bool</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>str</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Label for <code>PREDICTED_END_LINE</code></p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/functional.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_get_label</span><span class="p">(</span><span class="n">prediction</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns the label for the prediction `PREDICTED_END_LINE`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prediction : bool</span>
<span class="sd">        value of `PREDICTED_END_LINE`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Label for `PREDICTED_END_LINE`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prediction</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;end_line&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;space&quot;</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="edsnlp.pipelines.core.endlines.functional.get_dir_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_dir_path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code>


</h4>


    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/functional.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_dir_path</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="n">path_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">path_file</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="edsnlp.pipelines.core.endlines.functional.build_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_path</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">)</span></code>


</h4>


    <div class="doc doc-contents ">

      <p>Function to build an absolut path.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file</code></td>
          <td class="doc-param-details">
            
            <p>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>relative_path</code></td>
          <td class="doc-param-details">
            <p>relative path from the main file to the desired output</p>
            <p>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>path</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/functional.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_path</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to build an absolut path.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file: main file from where we are calling. It could be __file__</span>
<span class="sd">    relative_path: str,</span>
<span class="sd">        relative path from the main file to the desired output</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    path: absolute path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">get_dir_path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">path</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="edsnlp.pipelines.core.endlines.functional._convert_series_to_array" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>


</h4>


    <div class="doc doc-contents ">

      <p>Converts pandas series of n elements to an array of shape (n,1).</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>s</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>np.ndarray</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/functional.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_convert_series_to_array</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Converts pandas series of n elements to an array of shape (n,1).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : pd.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>  <span class="c1"># .astype(np.int64)</span>
    <span class="k">return</span> <span class="n">X</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="edsnlp.pipelines.core.endlines.endlinesmodel" class="doc doc-heading">
        <code>endlinesmodel</code>



</h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel" class="doc doc-heading">
          <code>EndLinesModel</code>



</h4>


    <div class="doc doc-contents ">


      <p>Model to classify if an end line is a real one or it should be a space.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nlp</code></td>
          <td class="doc-param-details">
            <p>spaCy nlp pipeline to use for matching.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Language</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>


          <details class="quote">
            <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
            <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">EndLinesModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Model to classify if an end line is a real one or it should be a space.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nlp : Language</span>
<span class="sd">        spaCy nlp pipeline to use for matching.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>

    <span class="k">def</span> <span class="nf">_preprocess_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Doc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus : Iterable[Doc]</span>
<span class="sd">            Corpus of documents</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Preprocessed data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract the vocabulary</span>
        <span class="n">string_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span>

        <span class="c1"># Iterate in the corpus and construct a dataframe</span>
        <span class="n">train_data_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus</span><span class="p">):</span>
            <span class="n">train_data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_attributes</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">train_data_list</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ORTH&quot;</span><span class="p">:</span> <span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;original_token_index&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Retrieve string representation of token_id and shape</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TEXT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_string</span><span class="p">,</span> <span class="n">string_store</span><span class="o">=</span><span class="n">string_store</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SHAPE_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_string</span><span class="p">,</span> <span class="n">string_store</span><span class="o">=</span><span class="n">string_store</span><span class="p">)</span>

        <span class="c1"># Convert new lines as an attribute instead of a row</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_line_to_attribute</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_line_to_attribute</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TEMP_END_LINE&quot;</span><span class="p">:</span> <span class="s2">&quot;END_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_BLANK_LINE&quot;</span><span class="p">:</span> <span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">},</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Construct A2 by shifting</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">)</span>

        <span class="c1"># Compute A3 and A4</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_a3</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">,</span> <span class="s2">&quot;A4&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">)</span>

        <span class="c1"># SPACE is the class to predict. Set 1 if not an END_LINE</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SPACE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
            <span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Assign a sentence id to each token</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_lines</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

        <span class="c1"># Compute B1 and B2</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_B</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Drop Tokens without info (last token of doc)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">,</span> <span class="s2">&quot;A4&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Export the vocabularies to be able to use the model with another corpus</span>
        <span class="n">voc_a3a4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_vocabulary</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">A3_</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
        <span class="n">voc_B2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_vocabulary</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cv_bin</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
        <span class="n">voc_B1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_vocabulary</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">l_norm_bin</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>

        <span class="n">vocabulary</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A3A4&quot;</span><span class="p">:</span> <span class="n">voc_a3a4</span><span class="p">,</span> <span class="s2">&quot;B1&quot;</span><span class="p">:</span> <span class="n">voc_B1</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">:</span> <span class="n">voc_B2</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span> <span class="o">=</span> <span class="n">vocabulary</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">fit_and_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Doc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Fit the model and predict for the training data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus : Iterable[Doc]</span>
<span class="sd">            An iterable of Documents</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            one line by end_line prediction</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Preprocess data to have a pd DF</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>

        <span class="c1"># Train and predict M1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_M1</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">A3</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">A4</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">SPACE</span><span class="p">)</span>
        <span class="n">outputs_M1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_M1</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span>
            <span class="n">df</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span>
            <span class="n">df</span><span class="o">.</span><span class="n">A3</span><span class="p">,</span>
            <span class="n">df</span><span class="o">.</span><span class="n">A4</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M1</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M1</span><span class="p">[</span><span class="s2">&quot;predictions_proba&quot;</span><span class="p">]</span>

        <span class="c1"># Force Blank lines to 0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">,</span> <span class="s2">&quot;M1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Train and predict M2</span>
        <span class="n">df_endlines</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_M2</span><span class="p">(</span><span class="n">B1</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">B2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">M1</span><span class="p">)</span>
        <span class="n">outputs_M2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_M2</span><span class="p">(</span><span class="n">B1</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">B2</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">,</span> <span class="s2">&quot;M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M2</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">,</span> <span class="s2">&quot;M2_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M2</span><span class="p">[</span><span class="s2">&quot;predictions_proba&quot;</span><span class="p">]</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Int64Dtype</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># cast to pd.Int64Dtype cause there are None values</span>

        <span class="c1"># M1M2</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2_lr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2_lr&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

        <span class="c1"># Force Blank lines to 0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">,</span> <span class="s2">&quot;M1M2&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Make binary col</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;PREDICTED_END_LINE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Use the model for inference</span>

<span class="sd">        The df should have the following columns:</span>
<span class="sd">        `[&quot;A1&quot;,&quot;A2&quot;,&quot;A3&quot;,&quot;A4&quot;,&quot;B1&quot;,&quot;B2&quot;,&quot;BLANK_LINE&quot;]`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            The df should have the following columns:</span>
<span class="sd">            `[&quot;A1&quot;,&quot;A2&quot;,&quot;A3&quot;,&quot;A4&quot;,&quot;B1&quot;,&quot;B2&quot;,&quot;BLANK_LINE&quot;]`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            The result is added to the column `PREDICTED_END_LINE`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_raw_data_to_codes</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">outputs_M1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_M1</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">_A3</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">_A4</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M1</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M1</span><span class="p">[</span><span class="s2">&quot;predictions_proba&quot;</span><span class="p">]</span>

        <span class="n">outputs_M2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_M2</span><span class="p">(</span><span class="n">B1</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">_B1</span><span class="p">,</span> <span class="n">B2</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">_B2</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M2</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M2</span><span class="p">[</span><span class="s2">&quot;predictions_proba&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Int64Dtype</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># cast to pd.Int64Dtype cause there are None values</span>

        <span class="c1"># M1M2</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2_lr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2_lr&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

        <span class="c1"># Force Blank lines to 0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">df</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;M1M2&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Make binary col</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;PREDICTED_END_LINE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;base_model.pkl&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save a pickle of the model. It could be read by the pipeline later.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str, optional</span>
<span class="sd">            path to file .pkl, by default `base_model.pkl`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outp</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outp</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convert_A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">        col : str</span>
<span class="sd">            column to translate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cat_type_A</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span>
            <span class="n">categories</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="s2">&quot;A3A4&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">new_col</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">col</span>
        <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">cat_type_A</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
        <span class="c1"># Ensure that not known values are coded as OTHER</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="s2">&quot;A3A4&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">new_col</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="s2">&quot;A3A4&quot;</span><span class="p">][</span><span class="s2">&quot;OTHER&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_convert_B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            [description]</span>
<span class="sd">        col : str</span>
<span class="sd">            column to translate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Translate B1</span>
        <span class="n">index_B</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IntervalIndex</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">new_col</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">col</span>
        <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">index_B</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">index_B</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">index_B</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_convert_raw_data_to_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to translate data as extracted from spacy to the model codes.</span>
<span class="sd">        `A1` and `A2` are not translated cause are supposed to be already</span>
<span class="sd">        in good encoding.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            It should have columns `[&#39;A3&#39;,&#39;A4&#39;,&#39;B1&#39;,&#39;B2&#39;]`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_A</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_A</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;A4&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_B</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;B1&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_B</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_convert_line_to_attribute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to convert a line into an attribute (column) of the</span>
<span class="sd">        previous row. Particularly we use it to identify &quot;\\n&quot; and &quot;\\n\\n&quot;</span>
<span class="sd">        that are considered tokens, express this information as an attribute</span>
<span class="sd">        of the previous token.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">        expr : str</span>
<span class="sd">            pattern to search in the text. Ex.: &quot;\\n&quot;</span>
<span class="sd">        col : str</span>
<span class="sd">            name of the new column</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">TEXT</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="s2">&quot;TEMP_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_compute_a3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A3 (A4 respectively): typographic form  of left word (or right) :</span>

<span class="sd">        - All in capital letter</span>
<span class="sd">        - It starts with a capital letter</span>
<span class="sd">        - Starts by lowercase</span>
<span class="sd">        - It&#39;s a number</span>
<span class="sd">        - Strong punctuation</span>
<span class="sd">        - Soft punctuation</span>
<span class="sd">        - A number followed or preced by a punctuation (it&#39;s the case of enumerations)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df: pd.DataFrame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df: pd.DataFrame with the columns `A3` and `A3_`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT&quot;</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT_+1&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT&quot;</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT_-1&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">CONDITION1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">IS_UPPER</span>
        <span class="n">CONDITION2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SHAPE_</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Xx&quot;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">CONDITION3</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SHAPE_</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">CONDITION4</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">IS_DIGIT</span>
        <span class="n">STRONG_PUNCT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">]</span>
        <span class="n">CONDITION5</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">IS_PUNCT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">TEXT</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">STRONG_PUNCT</span><span class="p">))</span>
        <span class="n">CONDITION6</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">IS_PUNCT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">TEXT</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">STRONG_PUNCT</span><span class="p">))</span>
        <span class="n">CONDITION7</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">IS_DIGIT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;IS_PUNCT_+1&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;IS_PUNCT_-1&quot;</span><span class="p">])</span>  <span class="c1"># discuss</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION1</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;UPPER&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION2</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;S_UPPER&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION3</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION4</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DIGIT&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION5</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;STRONG_PUNCT&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION6</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SOFT_PUNCT&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION7</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ENUMERATION&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IS_PUNCT_+1&quot;</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT_-1&quot;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">(</span><span class="s2">&quot;OTHER&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;OTHER&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_fit_M1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">A1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">A2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">A3</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">A4</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to train M1 classifier (Naive Bayes)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        A1 : pd.Series</span>
<span class="sd">            [description]</span>
<span class="sd">        A2 : pd.Series</span>
<span class="sd">            [description]</span>
<span class="sd">        A3 : pd.Series</span>
<span class="sd">            [description]</span>
<span class="sd">        A4 : pd.Series</span>
<span class="sd">            [description]</span>
<span class="sd">        label : pd.Series</span>
<span class="sd">            [description]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Encode classes to OneHotEncoder representation</span>
        <span class="n">encoder_A1_A2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_encoder_2S</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_A1_A2</span> <span class="o">=</span> <span class="n">encoder_A1_A2</span>

        <span class="n">encoder_A3_A4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_encoder_2S</span><span class="p">(</span><span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_A3_A4</span> <span class="o">=</span> <span class="n">encoder_A3_A4</span>

        <span class="c1"># M1</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">MultinomialNB</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_X_for_M1</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span>
        <span class="n">m1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span>

    <span class="k">def</span> <span class="nf">_fit_M2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">B2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to train M2 classifier (Naive Bayes)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        B1 : pd.Series</span>
<span class="sd">        B2 : pd.Series</span>
<span class="sd">        label : pd.Series</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Encode classes to OneHotEncoder representation</span>
        <span class="n">encoder_B1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_encoder_1S</span><span class="p">(</span><span class="n">B1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_B1</span> <span class="o">=</span> <span class="n">encoder_B1</span>
        <span class="n">encoder_B2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_encoder_1S</span><span class="p">(</span><span class="n">B2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_B2</span> <span class="o">=</span> <span class="n">encoder_B2</span>

        <span class="c1"># Multinomial Naive Bayes</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">MultinomialNB</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_X_for_M2</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">)</span>
        <span class="n">m2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span>

    <span class="k">def</span> <span class="nf">_get_X_for_M1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">A1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A3</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A4</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get X matrix for classifier</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        A1 : pd.Series</span>
<span class="sd">        A2 : pd.Series</span>
<span class="sd">        A3 : pd.Series</span>
<span class="sd">        A4 : pd.Series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">A1_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_A1_A2</span><span class="p">,</span> <span class="n">A1</span><span class="p">)</span>
        <span class="n">A2_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_A1_A2</span><span class="p">,</span> <span class="n">A2</span><span class="p">)</span>
        <span class="n">A3_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_A3_A4</span><span class="p">,</span> <span class="n">A3</span><span class="p">)</span>
        <span class="n">A4_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_A3_A4</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">A1_enc</span><span class="p">,</span> <span class="n">A2_enc</span><span class="p">,</span> <span class="n">A3_enc</span><span class="p">,</span> <span class="n">A4_enc</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">_get_X_for_M2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">B2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get X matrix for classifier</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        B1 : pd.Series</span>
<span class="sd">        B2 : pd.Series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">B1_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_B1</span><span class="p">,</span> <span class="n">B1</span><span class="p">)</span>
        <span class="n">B2_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_B2</span><span class="p">,</span> <span class="n">B2</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">B1_enc</span><span class="p">,</span> <span class="n">B2_enc</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">_predict_M1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">A1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A3</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A4</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Use M1 for prediction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        A1 : pd.Series</span>
<span class="sd">        A2 : pd.Series</span>
<span class="sd">        A3 : pd.Series</span>
<span class="sd">        A4 : pd.Series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_X_for_M1</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">predictions_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="n">predictions</span><span class="p">,</span> <span class="s2">&quot;predictions_proba&quot;</span><span class="p">:</span> <span class="n">predictions_proba</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">_predict_M2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">B2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Use M2 for prediction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        B1 : pd.Series</span>
<span class="sd">        B2 : pd.Series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_X_for_M2</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">predictions_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="n">predictions</span><span class="p">,</span> <span class="s2">&quot;predictions_proba&quot;</span><span class="p">:</span> <span class="n">predictions_proba</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">_fit_encoder_2S</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">S2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OneHotEncoder</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Fit a one hot encoder with 2 Series. It concatenates the series and after it fits.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        S1 : pd.Series</span>
<span class="sd">        S2 : pd.Series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OneHotEncoder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_S1</span> <span class="o">=</span> <span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
        <span class="n">_S2</span> <span class="o">=</span> <span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">_S1</span><span class="p">,</span> <span class="n">_S2</span><span class="p">])</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_one_hot_encoder</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">encoder</span>

    <span class="k">def</span> <span class="nf">_fit_encoder_1S</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OneHotEncoder</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Fit a one hot encoder with 1 Series.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        S1 : pd.Series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OneHotEncoder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_S1</span> <span class="o">=</span> <span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_one_hot_encoder</span><span class="p">(</span><span class="n">_S1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">encoder</span>

    <span class="k">def</span> <span class="nf">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoder</span><span class="p">:</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">S</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Use the one hot encoder to transform a series.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        encoder : OneHotEncoder</span>
<span class="sd">        S : pd.Series</span>
<span class="sd">            a series to encode (transform)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_S</span> <span class="o">=</span> <span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
        <span class="n">S_enc</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">_S</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">S_enc</span>

    <span class="k">def</span> <span class="nf">set_spans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Doc</span><span class="p">],</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to set the results of the algorithm (pd.DataFrame)</span>
<span class="sd">        as spans of the spaCy document.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus : Iterable[Doc]</span>
<span class="sd">            Iterable of spaCy Documents</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            It should have the columns:</span>
<span class="sd">            [&quot;DOC_ID&quot;,&quot;original_token_index&quot;,&quot;PREDICTED_END_LINE&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus</span><span class="p">):</span>
            <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">token_i</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">df</span><span class="o">.</span><span class="n">DOC_ID</span> <span class="o">==</span> <span class="n">doc_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;original_token_index&quot;</span><span class="p">,</span> <span class="s2">&quot;PREDICTED_END_LINE&quot;</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">token_i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">token_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_get_label</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span>

                <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

            <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="s2">&quot;new_lines&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spans</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_retrieve_lines</span><span class="p">(</span><span class="n">dfg</span><span class="p">:</span> <span class="n">DataFrameGroupBy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrameGroupBy</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Function to give a sentence_id to each token.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dfg : DataFrameGroupBy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DataFrameGroupBy</span>
<span class="sd">            Same DataFrameGroupBy with the column `SENTENCE_ID`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sentences_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dfg</span><span class="o">.</span><span class="n">END_LINE</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="n">dfg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dfg</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentences_ids</span>
        <span class="n">dfg</span><span class="p">[</span><span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfg</span><span class="p">[</span><span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfill&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dfg</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_vocabulary</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Function to create a vocabulary for attributes in the training set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : iterable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">v</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compute_B</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Function to compute B1 and B2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;LENGTH&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">))</span>
        <span class="n">df_t</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">],</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span>

        <span class="n">stats_doc</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">))</span>
        <span class="n">stats_doc</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>  <span class="c1"># Replace the 0 std by unit std, otherwise it breaks the code.</span>
        <span class="n">stats_doc</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_doc</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">stats_doc</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span>

        <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">])</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_t</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

        <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">stats_doc</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l_norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span>

        <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;cv_bin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;B2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;cv_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

        <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l_norm_bin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l_norm&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;B1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l_norm_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

        <span class="k">return</span> <span class="n">df2</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_shift_col</span><span class="p">(</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Shifts a column one position into backward / forward direction.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">        col : str</span>
<span class="sd">            column to shift</span>
<span class="sd">        new_col : str</span>
<span class="sd">            column name to save the results</span>
<span class="sd">        direction : str, optional</span>
<span class="sd">            one of {&quot;backward&quot;, &quot;forward&quot;}, by default &quot;backward&quot;</span>
<span class="sd">        fill : [type], optional</span>
<span class="sd">            , by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            same df with `new_col` added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="n">different_doc_id</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">different_doc_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">different_doc_id</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">different_doc_id</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">different_doc_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">different_doc_id</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">different_doc_id</span><span class="p">,</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_attributes</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to get the attributes of tokens of a spacy doc in a pd.DataFrame format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        doc : Doc</span>
<span class="sd">            spacy Doc</span>
<span class="sd">        i : int, optional</span>
<span class="sd">            document id, by default 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Returns a dataframe with one line per token. It has the following columns :</span>
<span class="sd">            `[</span>
<span class="sd">            &quot;ORTH&quot;,</span>
<span class="sd">            &quot;LOWER&quot;,</span>
<span class="sd">            &quot;SHAPE&quot;,</span>
<span class="sd">            &quot;IS_DIGIT&quot;,</span>
<span class="sd">            &quot;IS_SPACE&quot;,</span>
<span class="sd">            &quot;IS_UPPER&quot;,</span>
<span class="sd">            &quot;IS_PUNCT&quot;,</span>
<span class="sd">            &quot;LENGTH&quot;,</span>
<span class="sd">            ]`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;ORTH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SHAPE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IS_DIGIT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IS_SPACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IS_UPPER&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IS_PUNCT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LENGTH&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">attributes_array</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">to_array</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">attributes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">attributes_array</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">attributes_df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">boolean_attr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;IS_&quot;</span><span class="p">:</span>
                <span class="n">boolean_attr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">attributes_df</span><span class="p">[</span><span class="n">boolean_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes_df</span><span class="p">[</span><span class="n">boolean_attr</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;boolean&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">attributes_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_string</span><span class="p">(</span><span class="n">_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">string_store</span><span class="p">:</span> <span class="n">StringStore</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the string corresponding to the token_id</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _id : int</span>
<span class="sd">            token id</span>
<span class="sd">        string_store : StringStore</span>
<span class="sd">            spaCy Language String Store</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            string representation of the token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">string_store</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_fit_one_hot_encoder</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OneHotEncoder</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Fit a one hot encoder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : np.ndarray</span>
<span class="sd">            of shape (n,1)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OneHotEncoder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="n">encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">encoder</span>
</code></pre></div>
</td></tr></table>
          </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.nlp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

  </div>





  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._preprocess_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_preprocess_data</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">


  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>corpus</code></td>
          <td class="doc-param-details">
            <p>Corpus of documents</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Iterable[Doc]</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Preprocessed data</p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_preprocess_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Doc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    corpus : Iterable[Doc]</span>
<span class="sd">        Corpus of documents</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        Preprocessed data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract the vocabulary</span>
    <span class="n">string_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span>

    <span class="c1"># Iterate in the corpus and construct a dataframe</span>
    <span class="n">train_data_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus</span><span class="p">):</span>
        <span class="n">train_data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_attributes</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">train_data_list</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ORTH&quot;</span><span class="p">:</span> <span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;original_token_index&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Retrieve string representation of token_id and shape</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TEXT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_string</span><span class="p">,</span> <span class="n">string_store</span><span class="o">=</span><span class="n">string_store</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SHAPE_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_string</span><span class="p">,</span> <span class="n">string_store</span><span class="o">=</span><span class="n">string_store</span><span class="p">)</span>

    <span class="c1"># Convert new lines as an attribute instead of a row</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_line_to_attribute</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_line_to_attribute</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TEMP_END_LINE&quot;</span><span class="p">:</span> <span class="s2">&quot;END_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_BLANK_LINE&quot;</span><span class="p">:</span> <span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">},</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Construct A2 by shifting</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">)</span>

    <span class="c1"># Compute A3 and A4</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_a3</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">,</span> <span class="s2">&quot;A4&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">)</span>

    <span class="c1"># SPACE is the class to predict. Set 1 if not an END_LINE</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SPACE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;END_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK_LINE&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
        <span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># Assign a sentence id to each token</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_lines</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

    <span class="c1"># Compute B1 and B2</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_B</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># Drop Tokens without info (last token of doc)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">,</span> <span class="s2">&quot;A4&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Export the vocabularies to be able to use the model with another corpus</span>
    <span class="n">voc_a3a4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_vocabulary</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">A3_</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
    <span class="n">voc_B2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_vocabulary</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cv_bin</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
    <span class="n">voc_B1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_vocabulary</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">l_norm_bin</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>

    <span class="n">vocabulary</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A3A4&quot;</span><span class="p">:</span> <span class="n">voc_a3a4</span><span class="p">,</span> <span class="s2">&quot;B1&quot;</span><span class="p">:</span> <span class="n">voc_B1</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">:</span> <span class="n">voc_B2</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span> <span class="o">=</span> <span class="n">vocabulary</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.fit_and_predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit_and_predict</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Fit the model and predict for the training data</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>corpus</code></td>
          <td class="doc-param-details">
            <p>An iterable of Documents</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Iterable[Doc]</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>one line by end_line prediction</p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fit_and_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Doc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Fit the model and predict for the training data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    corpus : Iterable[Doc]</span>
<span class="sd">        An iterable of Documents</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        one line by end_line prediction</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Preprocess data to have a pd DF</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>

    <span class="c1"># Train and predict M1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fit_M1</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">A3</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">A4</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">SPACE</span><span class="p">)</span>
    <span class="n">outputs_M1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_M1</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span>
        <span class="n">df</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span>
        <span class="n">df</span><span class="o">.</span><span class="n">A3</span><span class="p">,</span>
        <span class="n">df</span><span class="o">.</span><span class="n">A4</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M1</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M1</span><span class="p">[</span><span class="s2">&quot;predictions_proba&quot;</span><span class="p">]</span>

    <span class="c1"># Force Blank lines to 0</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">,</span> <span class="s2">&quot;M1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Train and predict M2</span>
    <span class="n">df_endlines</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fit_M2</span><span class="p">(</span><span class="n">B1</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">B2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">M1</span><span class="p">)</span>
    <span class="n">outputs_M2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_M2</span><span class="p">(</span><span class="n">B1</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="o">=</span><span class="n">df_endlines</span><span class="o">.</span><span class="n">B2</span><span class="p">)</span>

    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">,</span> <span class="s2">&quot;M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M2</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">,</span> <span class="s2">&quot;M2_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M2</span><span class="p">[</span><span class="s2">&quot;predictions_proba&quot;</span><span class="p">]</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">Int64Dtype</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># cast to pd.Int64Dtype cause there are None values</span>

    <span class="c1"># M1M2</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2_lr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2_lr&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

    <span class="c1"># Force Blank lines to 0</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">,</span> <span class="s2">&quot;M1M2&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Make binary col</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;PREDICTED_END_LINE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Use the model for inference</p>
<p>The df should have the following columns:
<code>["A1","A2","A3","A4","B1","B2","BLANK_LINE"]</code></p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            <p>The df should have the following columns:
<code>["A1","A2","A3","A4","B1","B2","BLANK_LINE"]</code></p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.DataFrame</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>The result is added to the column <code>PREDICTED_END_LINE</code></p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Use the model for inference</span>

<span class="sd">    The df should have the following columns:</span>
<span class="sd">    `[&quot;A1&quot;,&quot;A2&quot;,&quot;A3&quot;,&quot;A4&quot;,&quot;B1&quot;,&quot;B2&quot;,&quot;BLANK_LINE&quot;]`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        The df should have the following columns:</span>
<span class="sd">        `[&quot;A1&quot;,&quot;A2&quot;,&quot;A3&quot;,&quot;A4&quot;,&quot;B1&quot;,&quot;B2&quot;,&quot;BLANK_LINE&quot;]`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        The result is added to the column `PREDICTED_END_LINE`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_raw_data_to_codes</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">outputs_M1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_M1</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">_A3</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">_A4</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M1</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M1</span><span class="p">[</span><span class="s2">&quot;predictions_proba&quot;</span><span class="p">]</span>

    <span class="n">outputs_M2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_M2</span><span class="p">(</span><span class="n">B1</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">_B1</span><span class="p">,</span> <span class="n">B2</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">_B2</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M2</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_M2</span><span class="p">[</span><span class="s2">&quot;predictions_proba&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">Int64Dtype</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># cast to pd.Int64Dtype cause there are None values</span>

    <span class="c1"># M1M2</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2_lr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M2_proba&quot;</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1_proba&quot;</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2_lr&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

    <span class="c1"># Force Blank lines to 0</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">df</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="s2">&quot;M1M2&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Make binary col</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;PREDICTED_END_LINE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;M1M2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.save" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;base_model.pkl&#39;</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Save a pickle of the model. It could be read by the pipeline later.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td class="doc-param-details">
            <p>path to file .pkl, by default <code>base_model.pkl</code></p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>&#39;base_model.pkl&#39;</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;base_model.pkl&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save a pickle of the model. It could be read by the pipeline later.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str, optional</span>
<span class="sd">        path to file .pkl, by default `base_model.pkl`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outp</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outp</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._convert_A" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_convert_A</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">


  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.DataFrame</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>col</code></td>
          <td class="doc-param-details">
            <p>column to translate</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_convert_A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">    col : str</span>
<span class="sd">        column to translate</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cat_type_A</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span>
        <span class="n">categories</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="s2">&quot;A3A4&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">new_col</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">col</span>
    <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">cat_type_A</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
    <span class="c1"># Ensure that not known values are coded as OTHER</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="s2">&quot;A3A4&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">new_col</span>
    <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="s2">&quot;A3A4&quot;</span><span class="p">][</span><span class="s2">&quot;OTHER&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._convert_B" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_convert_B</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">


  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            <p>[description]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.DataFrame</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>col</code></td>
          <td class="doc-param-details">
            <p>column to translate</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>[description]</p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_convert_B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        [description]</span>
<span class="sd">    col : str</span>
<span class="sd">        column to translate</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        [description]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Translate B1</span>
    <span class="n">index_B</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IntervalIndex</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">new_col</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">col</span>
    <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">index_B</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">index_B</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">index_B</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._convert_raw_data_to_codes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_convert_raw_data_to_codes</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to translate data as extracted from spacy to the model codes.
<code>A1</code> and <code>A2</code> are not translated cause are supposed to be already
in good encoding.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            <p>It should have columns <code>['A3','A4','B1','B2']</code></p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.DataFrame</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_convert_raw_data_to_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to translate data as extracted from spacy to the model codes.</span>
<span class="sd">    `A1` and `A2` are not translated cause are supposed to be already</span>
<span class="sd">    in good encoding.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        It should have columns `[&#39;A3&#39;,&#39;A4&#39;,&#39;B1&#39;,&#39;B2&#39;]`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_A</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_A</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;A4&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_B</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;B1&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_B</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._convert_line_to_attribute" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_convert_line_to_attribute</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to convert a line into an attribute (column) of the
previous row. Particularly we use it to identify "\n" and "\n\n"
that are considered tokens, express this information as an attribute
of the previous token.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.DataFrame</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>expr</code></td>
          <td class="doc-param-details">
            <p>pattern to search in the text. Ex.: "\n"</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>col</code></td>
          <td class="doc-param-details">
            <p>name of the new column</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_convert_line_to_attribute</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to convert a line into an attribute (column) of the</span>
<span class="sd">    previous row. Particularly we use it to identify &quot;\\n&quot; and &quot;\\n\\n&quot;</span>
<span class="sd">    that are considered tokens, express this information as an attribute</span>
<span class="sd">    of the previous token.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">    expr : str</span>
<span class="sd">        pattern to search in the text. Ex.: &quot;\\n&quot;</span>
<span class="sd">    col : str</span>
<span class="sd">        name of the new column</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">TEXT</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="s2">&quot;TEMP_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._compute_a3" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_compute_a3</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>A3 (A4 respectively): typographic form  of left word (or right) :</p>
<ul>
<li>All in capital letter</li>
<li>It starts with a capital letter</li>
<li>Starts by lowercase</li>
<li>It's a number</li>
<li>Strong punctuation</li>
<li>Soft punctuation</li>
<li>A number followed or preced by a punctuation (it's the case of enumerations)</li>
</ul>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>df</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_compute_a3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A3 (A4 respectively): typographic form  of left word (or right) :</span>

<span class="sd">    - All in capital letter</span>
<span class="sd">    - It starts with a capital letter</span>
<span class="sd">    - Starts by lowercase</span>
<span class="sd">    - It&#39;s a number</span>
<span class="sd">    - Strong punctuation</span>
<span class="sd">    - Soft punctuation</span>
<span class="sd">    - A number followed or preced by a punctuation (it&#39;s the case of enumerations)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df: pd.DataFrame</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df: pd.DataFrame with the columns `A3` and `A3_`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT&quot;</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT_+1&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_col</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT&quot;</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT_-1&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="n">CONDITION1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">IS_UPPER</span>
    <span class="n">CONDITION2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SHAPE_</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Xx&quot;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">CONDITION3</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SHAPE_</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">CONDITION4</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">IS_DIGIT</span>
    <span class="n">STRONG_PUNCT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">]</span>
    <span class="n">CONDITION5</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">IS_PUNCT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">TEXT</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">STRONG_PUNCT</span><span class="p">))</span>
    <span class="n">CONDITION6</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">IS_PUNCT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">TEXT</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">STRONG_PUNCT</span><span class="p">))</span>
    <span class="n">CONDITION7</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">IS_DIGIT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;IS_PUNCT_+1&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;IS_PUNCT_-1&quot;</span><span class="p">])</span>  <span class="c1"># discuss</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION1</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;UPPER&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION2</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;S_UPPER&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION3</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION4</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DIGIT&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION5</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;STRONG_PUNCT&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION6</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SOFT_PUNCT&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">CONDITION7</span><span class="p">,</span> <span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ENUMERATION&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IS_PUNCT_+1&quot;</span><span class="p">,</span> <span class="s2">&quot;IS_PUNCT_-1&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">(</span><span class="s2">&quot;OTHER&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;OTHER&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A3_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_M1" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_fit_M1</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to train M1 classifier (Naive Bayes)</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>A1</code></td>
          <td class="doc-param-details">
            <p>[description]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A2</code></td>
          <td class="doc-param-details">
            <p>[description]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A3</code></td>
          <td class="doc-param-details">
            <p>[description]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A4</code></td>
          <td class="doc-param-details">
            <p>[description]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>label</code></td>
          <td class="doc-param-details">
            <p>[description]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_fit_M1</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">A1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">A2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">A3</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">A4</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to train M1 classifier (Naive Bayes)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A1 : pd.Series</span>
<span class="sd">        [description]</span>
<span class="sd">    A2 : pd.Series</span>
<span class="sd">        [description]</span>
<span class="sd">    A3 : pd.Series</span>
<span class="sd">        [description]</span>
<span class="sd">    A4 : pd.Series</span>
<span class="sd">        [description]</span>
<span class="sd">    label : pd.Series</span>
<span class="sd">        [description]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Encode classes to OneHotEncoder representation</span>
    <span class="n">encoder_A1_A2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_encoder_2S</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoder_A1_A2</span> <span class="o">=</span> <span class="n">encoder_A1_A2</span>

    <span class="n">encoder_A3_A4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_encoder_2S</span><span class="p">(</span><span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoder_A3_A4</span> <span class="o">=</span> <span class="n">encoder_A3_A4</span>

    <span class="c1"># M1</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">MultinomialNB</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_X_for_M1</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span>
    <span class="n">m1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_M2" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_fit_M2</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to train M2 classifier (Naive Bayes)</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>B1</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>B2</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>label</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_fit_M2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">B2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to train M2 classifier (Naive Bayes)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    B1 : pd.Series</span>
<span class="sd">    B2 : pd.Series</span>
<span class="sd">    label : pd.Series</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Encode classes to OneHotEncoder representation</span>
    <span class="n">encoder_B1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_encoder_1S</span><span class="p">(</span><span class="n">B1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoder_B1</span> <span class="o">=</span> <span class="n">encoder_B1</span>
    <span class="n">encoder_B2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_encoder_1S</span><span class="p">(</span><span class="n">B2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoder_B2</span> <span class="o">=</span> <span class="n">encoder_B2</span>

    <span class="c1"># Multinomial Naive Bayes</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">MultinomialNB</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_X_for_M2</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">)</span>
    <span class="n">m2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._get_X_for_M1" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_get_X_for_M1</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Get X matrix for classifier</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>A1</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A2</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A3</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A4</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>np.ndarray</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_get_X_for_M1</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">A1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A3</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A4</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get X matrix for classifier</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A1 : pd.Series</span>
<span class="sd">    A2 : pd.Series</span>
<span class="sd">    A3 : pd.Series</span>
<span class="sd">    A4 : pd.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A1_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_A1_A2</span><span class="p">,</span> <span class="n">A1</span><span class="p">)</span>
    <span class="n">A2_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_A1_A2</span><span class="p">,</span> <span class="n">A2</span><span class="p">)</span>
    <span class="n">A3_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_A3_A4</span><span class="p">,</span> <span class="n">A3</span><span class="p">)</span>
    <span class="n">A4_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_A3_A4</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">A1_enc</span><span class="p">,</span> <span class="n">A2_enc</span><span class="p">,</span> <span class="n">A3_enc</span><span class="p">,</span> <span class="n">A4_enc</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">X</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._get_X_for_M2" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_get_X_for_M2</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Get X matrix for classifier</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>B1</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>B2</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>np.ndarray</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_get_X_for_M2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">B2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get X matrix for classifier</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    B1 : pd.Series</span>
<span class="sd">    B2 : pd.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">B1_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_B1</span><span class="p">,</span> <span class="n">B1</span><span class="p">)</span>
    <span class="n">B2_enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_B2</span><span class="p">,</span> <span class="n">B2</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">B1_enc</span><span class="p">,</span> <span class="n">B2_enc</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">X</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._predict_M1" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_predict_M1</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Use M1 for prediction</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>A1</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A2</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A3</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>A4</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>Dict[str, Any]</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_predict_M1</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">A1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A3</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">A4</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Use M1 for prediction</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A1 : pd.Series</span>
<span class="sd">    A2 : pd.Series</span>
<span class="sd">    A3 : pd.Series</span>
<span class="sd">    A4 : pd.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dict[str, Any]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_X_for_M1</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">predictions_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="n">predictions</span><span class="p">,</span> <span class="s2">&quot;predictions_proba&quot;</span><span class="p">:</span> <span class="n">predictions_proba</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">outputs</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._predict_M2" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_predict_M2</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Use M2 for prediction</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>B1</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>B2</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>Dict[str, Any]</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_predict_M2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">B2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Use M2 for prediction</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    B1 : pd.Series</span>
<span class="sd">    B2 : pd.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dict[str, Any]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_X_for_M2</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">predictions_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="n">predictions</span><span class="p">,</span> <span class="s2">&quot;predictions_proba&quot;</span><span class="p">:</span> <span class="n">predictions_proba</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">outputs</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_encoder_2S" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_fit_encoder_2S</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Fit a one hot encoder with 2 Series. It concatenates the series and after it fits.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>S1</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>S2</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>OneHotEncoder</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_fit_encoder_2S</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">S2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OneHotEncoder</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Fit a one hot encoder with 2 Series. It concatenates the series and after it fits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    S1 : pd.Series</span>
<span class="sd">    S2 : pd.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OneHotEncoder</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_S1</span> <span class="o">=</span> <span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
    <span class="n">_S2</span> <span class="o">=</span> <span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">_S1</span><span class="p">,</span> <span class="n">_S2</span><span class="p">])</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_one_hot_encoder</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">encoder</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_encoder_1S" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_fit_encoder_1S</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Fit a one hot encoder with 1 Series.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>S1</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>OneHotEncoder</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_fit_encoder_1S</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OneHotEncoder</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Fit a one hot encoder with 1 Series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    S1 : pd.Series</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OneHotEncoder</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_S1</span> <span class="o">=</span> <span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_one_hot_encoder</span><span class="p">(</span><span class="n">_S1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">encoder</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._encode_series" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_encode_series</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Use the one hot encoder to transform a series.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>encoder</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>OneHotEncoder</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>S</code></td>
          <td class="doc-param-details">
            <p>a series to encode (transform)</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.Series</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>np.ndarray</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_encode_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoder</span><span class="p">:</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">S</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Use the one hot encoder to transform a series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    encoder : OneHotEncoder</span>
<span class="sd">    S : pd.Series</span>
<span class="sd">        a series to encode (transform)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_S</span> <span class="o">=</span> <span class="n">_convert_series_to_array</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
    <span class="n">S_enc</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">_S</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">S_enc</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel.set_spans" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_spans</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to set the results of the algorithm (pd.DataFrame)
as spans of the spaCy document.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>corpus</code></td>
          <td class="doc-param-details">
            <p>Iterable of spaCy Documents</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Iterable[Doc]</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            <p>It should have the columns:
["DOC_ID","original_token_index","PREDICTED_END_LINE"]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.DataFrame</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_spans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Doc</span><span class="p">],</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to set the results of the algorithm (pd.DataFrame)</span>
<span class="sd">    as spans of the spaCy document.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    corpus : Iterable[Doc]</span>
<span class="sd">        Iterable of spaCy Documents</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        It should have the columns:</span>
<span class="sd">        [&quot;DOC_ID&quot;,&quot;original_token_index&quot;,&quot;PREDICTED_END_LINE&quot;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus</span><span class="p">):</span>
        <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">token_i</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">df</span><span class="o">.</span><span class="n">DOC_ID</span> <span class="o">==</span> <span class="n">doc_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;original_token_index&quot;</span><span class="p">,</span> <span class="s2">&quot;PREDICTED_END_LINE&quot;</span><span class="p">]</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">token_i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">token_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_get_label</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span>

            <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="s2">&quot;new_lines&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spans</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._retrieve_lines" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_retrieve_lines</span><span class="p">(</span><span class="n">dfg</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to give a sentence_id to each token.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dfg</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>DataFrameGroupBy</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>DataFrameGroupBy</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Same DataFrameGroupBy with the column <code>SENTENCE_ID</code></p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_retrieve_lines</span><span class="p">(</span><span class="n">dfg</span><span class="p">:</span> <span class="n">DataFrameGroupBy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrameGroupBy</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Function to give a sentence_id to each token.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dfg : DataFrameGroupBy</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrameGroupBy</span>
<span class="sd">        Same DataFrameGroupBy with the column `SENTENCE_ID`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sentences_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dfg</span><span class="o">.</span><span class="n">END_LINE</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="n">dfg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dfg</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentences_ids</span>
    <span class="n">dfg</span><span class="p">[</span><span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfg</span><span class="p">[</span><span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfill&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dfg</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._create_vocabulary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_create_vocabulary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to create a vocabulary for attributes in the training set.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>iterable</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>dict</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_create_vocabulary</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Function to create a vocabulary for attributes in the training set.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : iterable</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._compute_B" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_compute_B</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to compute B1 and B2</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.DataFrame</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_compute_B</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Function to compute B1 and B2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;LENGTH&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">))</span>
    <span class="n">df_t</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">END_LINE</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">],</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
    <span class="p">)</span>

    <span class="n">stats_doc</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">))</span>
    <span class="n">stats_doc</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>  <span class="c1"># Replace the 0 std by unit std, otherwise it breaks the code.</span>
    <span class="n">stats_doc</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_doc</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">stats_doc</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span>

    <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SENTENCE_ID&quot;</span><span class="p">])</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_t</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

    <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">stats_doc</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l_norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span>

    <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;cv_bin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;B2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;cv_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

    <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l_norm_bin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l_norm&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;B1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;l_norm_bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

    <span class="k">return</span> <span class="n">df2</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._shift_col" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_shift_col</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">new_col</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Shifts a column one position into backward / forward direction.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>pd.DataFrame</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>col</code></td>
          <td class="doc-param-details">
            <p>column to shift</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>new_col</code></td>
          <td class="doc-param-details">
            <p>column name to save the results</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>direction</code></td>
          <td class="doc-param-details">
            <p>one of {"backward", "forward"}, by default "backward"</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>&#39;backward&#39;</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>fill</code></td>
          <td class="doc-param-details">
            <p>, by default None</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>[type], optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>None</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>same df with <code>new_col</code> added.</p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_shift_col</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Shifts a column one position into backward / forward direction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">    col : str</span>
<span class="sd">        column to shift</span>
<span class="sd">    new_col : str</span>
<span class="sd">        column name to save the results</span>
<span class="sd">    direction : str, optional</span>
<span class="sd">        one of {&quot;backward&quot;, &quot;forward&quot;}, by default &quot;backward&quot;</span>
<span class="sd">    fill : [type], optional</span>
<span class="sd">        , by default None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        same df with `new_col` added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill</span>

    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">different_doc_id</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">different_doc_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">different_doc_id</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">different_doc_id</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">different_doc_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">different_doc_id</span><span class="p">)</span>

    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">different_doc_id</span><span class="p">,</span> <span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._get_attributes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_get_attributes</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to get the attributes of tokens of a spacy doc in a pd.DataFrame format.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>doc</code></td>
          <td class="doc-param-details">
            <p>spacy Doc</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Doc</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>i</code></td>
          <td class="doc-param-details">
            <p>document id, by default 0</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>0</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Returns a dataframe with one line per token. It has the following columns :
<code>[
"ORTH",
"LOWER",
"SHAPE",
"IS_DIGIT",
"IS_SPACE",
"IS_UPPER",
"IS_PUNCT",
"LENGTH",
]</code></p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_get_attributes</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to get the attributes of tokens of a spacy doc in a pd.DataFrame format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    doc : Doc</span>
<span class="sd">        spacy Doc</span>
<span class="sd">    i : int, optional</span>
<span class="sd">        document id, by default 0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        Returns a dataframe with one line per token. It has the following columns :</span>
<span class="sd">        `[</span>
<span class="sd">        &quot;ORTH&quot;,</span>
<span class="sd">        &quot;LOWER&quot;,</span>
<span class="sd">        &quot;SHAPE&quot;,</span>
<span class="sd">        &quot;IS_DIGIT&quot;,</span>
<span class="sd">        &quot;IS_SPACE&quot;,</span>
<span class="sd">        &quot;IS_UPPER&quot;,</span>
<span class="sd">        &quot;IS_PUNCT&quot;,</span>
<span class="sd">        &quot;LENGTH&quot;,</span>
<span class="sd">        ]`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;ORTH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SHAPE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IS_DIGIT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IS_SPACE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IS_UPPER&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IS_PUNCT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LENGTH&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">attributes_array</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">to_array</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="n">attributes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">attributes_array</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>
    <span class="n">attributes_df</span><span class="p">[</span><span class="s2">&quot;DOC_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">boolean_attr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;IS_&quot;</span><span class="p">:</span>
            <span class="n">boolean_attr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">attributes_df</span><span class="p">[</span><span class="n">boolean_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes_df</span><span class="p">[</span><span class="n">boolean_attr</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;boolean&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">attributes_df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._get_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_get_string</span><span class="p">(</span><span class="n">_id</span><span class="p">,</span> <span class="n">string_store</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Returns the string corresponding to the token_id</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>_id</code></td>
          <td class="doc-param-details">
            <p>token id</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>string_store</code></td>
          <td class="doc-param-details">
            <p>spaCy Language String Store</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>StringStore</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>str</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>string representation of the token.</p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_get_string</span><span class="p">(</span><span class="n">_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">string_store</span><span class="p">:</span> <span class="n">StringStore</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns the string corresponding to the token_id</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    _id : int</span>
<span class="sd">        token id</span>
<span class="sd">    string_store : StringStore</span>
<span class="sd">        spaCy Language String Store</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        string representation of the token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">string_store</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlinesmodel.EndLinesModel._fit_one_hot_encoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_fit_one_hot_encoder</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Fit a one hot encoder.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td class="doc-param-details">
            <p>of shape (n,1)</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>np.ndarray</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>OneHotEncoder</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlinesmodel.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_fit_one_hot_encoder</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OneHotEncoder</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Fit a one hot encoder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : np.ndarray</span>
<span class="sd">        of shape (n,1)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OneHotEncoder</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
    <span class="n">encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">encoder</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="edsnlp.pipelines.core.endlines.endlines" class="doc doc-heading">
        <code>endlines</code>



</h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="edsnlp.pipelines.core.endlines.endlines.EndLines" class="doc doc-heading">
          <code>EndLines</code>



</h4>


    <div class="doc doc-contents ">
        <p class="doc doc-class-bases">
          Bases: <code><a title="edsnlp.pipelines.core.matcher.GenericMatcher" href="../../../../pipelines/core/matcher/matcher/#edsnlp.pipelines.core.matcher.matcher.GenericMatcher">GenericMatcher</a></code></p>


      <p>spaCy Pipeline to detect whether a newline character should
be considered a space (ie introduced by the PDF).</p>
<p>The pipeline will add the extension <code>end_line</code> to spans
and tokens. The <code>end_line</code> attribute is a boolean or <code>None</code>,
set to <code>True</code> if the pipeline predicts that the new line
is an end line character. Otherwise, it is  set to <code>False</code>
if the new line is classified as a space. If no classification
has been done over that token, it will remain <code>None</code>.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nlp</code></td>
          <td class="doc-param-details">
            <p>spaCy nlp pipeline to use for matching.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Language</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>
      <p>end_lines_model : Optional[Union[str, EndLinesModel]], by default None
    path to trained model. If None, it will use a default model</p>


          <details class="quote">
            <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlines.py</code></summary>
            <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">EndLines</span><span class="p">(</span><span class="n">GenericMatcher</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    spaCy Pipeline to detect whether a newline character should</span>
<span class="sd">    be considered a space (ie introduced by the PDF).</span>

<span class="sd">    The pipeline will add the extension `end_line` to spans</span>
<span class="sd">    and tokens. The `end_line` attribute is a boolean or `None`,</span>
<span class="sd">    set to `True` if the pipeline predicts that the new line</span>
<span class="sd">    is an end line character. Otherwise, it is  set to `False`</span>
<span class="sd">    if the new line is classified as a space. If no classification</span>
<span class="sd">    has been done over that token, it will remain `None`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nlp : Language</span>
<span class="sd">        spaCy nlp pipeline to use for matching.</span>

<span class="sd">    end_lines_model : Optional[Union[str, EndLinesModel]], by default None</span>
<span class="sd">        path to trained model. If None, it will use a default model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">end_lines_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EndLinesModel</span><span class="p">]],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">nlp</span><span class="p">,</span>
            <span class="n">terms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">attr</span><span class="o">=</span><span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">new_line</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\n+&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">ignore_excluded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">Token</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="s2">&quot;end_line&quot;</span><span class="p">):</span>
            <span class="n">Token</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;end_line&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="s2">&quot;end_line&quot;</span><span class="p">):</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;end_line&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_read_model</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_lines_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EndLinesModel</span><span class="p">]]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        end_lines_model : Optional[Union[str, EndLinesModel]]</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">end_lines_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">build_path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s2">&quot;base_model.pkl&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">)</span> <span class="o">==</span> <span class="n">EndLinesModel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">end_lines_model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;type(`end_lines_model`) should be one of {None, str, EndLinesModel}&quot;</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_spacy_compute_a3a4</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Function to compute A3 and A4</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        token : Token</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_upper</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;UPPER&quot;</span>

        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">shape_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Xx&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;S_UPPER&quot;</span>

        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">shape_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;LOWER&quot;</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">is_digit</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;ENUMERATION&quot;</span>

        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">is_digit</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;DIGIT&quot;</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="s2">&quot;STRONG_PUNCT&quot;</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="s2">&quot;SOFT_PUNCT&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;OTHER&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compute_length</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compute length without spaces</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        doc : Doc</span>
<span class="sd">        start : int</span>
<span class="sd">        end : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]:</span>
            <span class="n">length</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">length</span>

    <span class="k">def</span> <span class="nf">_get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">new_lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a pandas DataFrame to call the classifier</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        doc : Doc</span>
<span class="sd">        new_lines : List[Span]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">span</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_lines</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>

            <span class="n">max_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a1_token</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
            <span class="n">a2_token</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_index</span><span class="p">)]</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">a1_token</span><span class="o">.</span><span class="n">orth</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">a2_token</span><span class="o">.</span><span class="n">orth</span>
            <span class="n">a3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spacy_compute_a3a4</span><span class="p">(</span><span class="n">a1_token</span><span class="p">)</span>
            <span class="n">a4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spacy_compute_a3a4</span><span class="p">(</span><span class="n">a2_token</span><span class="p">)</span>
            <span class="n">blank_line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">text</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">start_previous</span> <span class="o">=</span> <span class="n">new_lines</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start_previous</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_length</span><span class="p">(</span>
                <span class="n">doc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_previous</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">start</span>
            <span class="p">)</span>  <span class="c1"># It&#39;s ok cause i count the total length from the previous up to this one</span>

            <span class="n">data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">span_start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                <span class="n">span_end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                <span class="n">A1</span><span class="o">=</span><span class="n">a1</span><span class="p">,</span>
                <span class="n">A2</span><span class="o">=</span><span class="n">a2</span><span class="p">,</span>
                <span class="n">A3</span><span class="o">=</span><span class="n">a3</span><span class="p">,</span>
                <span class="n">A4</span><span class="o">=</span><span class="n">a4</span><span class="p">,</span>
                <span class="n">BLANK_LINE</span><span class="o">=</span><span class="n">blank_line</span><span class="p">,</span>
                <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sigma</span><span class="p">):</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">cv</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">mu</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;B1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;B2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict for each new line if it&#39;s an end of line or a space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        doc: spaCy Doc object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        doc: spaCy Doc object, with each new line annotated</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="n">get_spans</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="s2">&quot;new_line&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">new_lines</span><span class="o">=</span><span class="n">new_lines</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

            <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">span</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_lines</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">PREDICTED_END_LINE</span><span class="p">):</span>

                <span class="n">span</span><span class="o">.</span><span class="n">label_</span> <span class="o">=</span> <span class="n">_get_label</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
                <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">prediction</span>

                <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">span</span><span class="p">:</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">prediction</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">prediction</span><span class="p">:</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">excluded</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="s2">&quot;new_lines&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spans</span>
        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div>
</td></tr></table>
          </details>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlines.EndLines.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">end_lines_model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlines.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">end_lines_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EndLinesModel</span><span class="p">]],</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">nlp</span><span class="p">,</span>
        <span class="n">terms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attr</span><span class="o">=</span><span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">new_line</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\n+&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">ignore_excluded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Token</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="s2">&quot;end_line&quot;</span><span class="p">):</span>
        <span class="n">Token</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;end_line&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="s2">&quot;end_line&quot;</span><span class="p">):</span>
        <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;end_line&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_read_model</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlines.EndLines._read_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_read_model</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">


  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>end_lines_model</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Optional[Union[str, EndLinesModel]]</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RAISES</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
            <span class="doc-raises-annotation">
                <code>TypeError</code>
            </span>
          </td>
          <td class="doc-raises-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlines.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_read_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_lines_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EndLinesModel</span><span class="p">]]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    end_lines_model : Optional[Union[str, EndLinesModel]]</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">end_lines_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">build_path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s2">&quot;base_model.pkl&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">end_lines_model</span><span class="p">)</span> <span class="o">==</span> <span class="n">EndLinesModel</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">end_lines_model</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;type(`end_lines_model`) should be one of {None, str, EndLinesModel}&quot;</span>
        <span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlines.EndLines._spacy_compute_a3a4" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_spacy_compute_a3a4</span><span class="p">(</span><span class="n">token</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Function to compute A3 and A4</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>token</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Token</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>str</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlines.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_spacy_compute_a3a4</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Function to compute A3 and A4</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    token : Token</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_upper</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;UPPER&quot;</span>

    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">shape_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Xx&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;S_UPPER&quot;</span>

    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">shape_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;LOWER&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">is_digit</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span>
        <span class="o">|</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ENUMERATION&quot;</span>

    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">is_digit</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;DIGIT&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">]):</span>
        <span class="k">return</span> <span class="s2">&quot;STRONG_PUNCT&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">]):</span>
        <span class="k">return</span> <span class="s2">&quot;SOFT_PUNCT&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;OTHER&quot;</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlines.EndLines._compute_length" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_compute_length</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Compute length without spaces</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>doc</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Doc</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>start</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>end</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>int</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlines.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_compute_length</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Compute length without spaces</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    doc : Doc</span>
<span class="sd">    start : int</span>
<span class="sd">    end : int</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]:</span>
        <span class="n">length</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">length</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlines.EndLines._get_df" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_get_df</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">new_lines</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Get a pandas DataFrame to call the classifier</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>doc</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>Doc</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>new_lines</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>List[Span]</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>pd.DataFrame</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlines.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">new_lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get a pandas DataFrame to call the classifier</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    doc : Doc</span>
<span class="sd">    new_lines : List[Span]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">span</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_lines</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>

        <span class="n">max_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">a1_token</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">a2_token</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_index</span><span class="p">)]</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">a1_token</span><span class="o">.</span><span class="n">orth</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">a2_token</span><span class="o">.</span><span class="n">orth</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spacy_compute_a3a4</span><span class="p">(</span><span class="n">a1_token</span><span class="p">)</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spacy_compute_a3a4</span><span class="p">(</span><span class="n">a2_token</span><span class="p">)</span>
        <span class="n">blank_line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">text</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start_previous</span> <span class="o">=</span> <span class="n">new_lines</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_previous</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_length</span><span class="p">(</span>
            <span class="n">doc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_previous</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">start</span>
        <span class="p">)</span>  <span class="c1"># It&#39;s ok cause i count the total length from the previous up to this one</span>

        <span class="n">data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">span_start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
            <span class="n">span_end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
            <span class="n">A1</span><span class="o">=</span><span class="n">a1</span><span class="p">,</span>
            <span class="n">A2</span><span class="o">=</span><span class="n">a2</span><span class="p">,</span>
            <span class="n">A3</span><span class="o">=</span><span class="n">a3</span><span class="p">,</span>
            <span class="n">A4</span><span class="o">=</span><span class="n">a4</span><span class="p">,</span>
            <span class="n">BLANK_LINE</span><span class="o">=</span><span class="n">blank_line</span><span class="p">,</span>
            <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sigma</span><span class="p">):</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">cv</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">mu</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;B1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;B2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="edsnlp.pipelines.core.endlines.endlines.EndLines.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>


</h5>


    <div class="doc doc-contents ">

      <p>Predict for each new line if it's an end of line or a space.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>doc</code></td>
          <td class="doc-param-details">
            
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="spacy.tokens.Doc">Doc</span></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>doc</code>
              </span>
          </td>
          <td class="doc-returns-details">
            
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>edsnlp/pipelines/core/endlines/endlines.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict for each new line if it&#39;s an end of line or a space.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    doc: spaCy Doc object</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    doc: spaCy Doc object, with each new line annotated</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="n">get_spans</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="s2">&quot;new_line&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">new_lines</span><span class="o">=</span><span class="n">new_lines</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">span</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_lines</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">PREDICTED_END_LINE</span><span class="p">):</span>

            <span class="n">span</span><span class="o">.</span><span class="n">label_</span> <span class="o">=</span> <span class="n">_get_label</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
            <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">prediction</span>

            <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">span</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">end_line</span> <span class="o">=</span> <span class="n">prediction</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">prediction</span><span class="p">:</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">excluded</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="s2">&quot;new_lines&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spans</span>
    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../context/factory/" class="md-footer__link md-footer__link--prev" aria-label="Previous: factory" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              factory
            </div>
          </div>
        </a>
      
      
        
        <a href="endlines/" class="md-footer__link md-footer__link--next" aria-label="Next: endlines" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              endlines
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tracking", "navigation.instant", "navigation.indexes", "navigation.top", "content.code.annotate"], "search": "../../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.748e2769.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
      
        <script src="../../../../assets/termynal/termynal.js"></script>
      
    
  </body>
</html>